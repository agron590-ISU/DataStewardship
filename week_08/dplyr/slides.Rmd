---
title: "`dplyr`"
author: "Ranae Dietzel & Andee Kaplan"
ratio: 16x10
output:
  rmdshower::shower_presentation:
    self_contained: false
    katex: true
    theme: ribbon
---

## `dplyr`, your new best f`R`iend

![](images/best_friends.gif)

## Motivation

There is a dataset in the `plyr` package that has yearly batting records for major league baseball players from 1871 to 2007.

```{r}
data(baseball, package="plyr")
head(baseball)
```

## Your turn { .cover .white }

<!-- image source https://www.flickr.com/photos/ollemhebb/16691684354/in/photolist-rqZfeh-dB2HGy-j4rtWV-cswQCb-bnmKUX-rurYD7-5vmdw6-7iHPtj-bvggjZ-7nwAyK-oVZdhD-acwkds-dqAf8f-e4z5Jk-6PBenY-dSAYZ9-5vmcGR-e4z7be-cyGrpE-7WLPaw-5vmdnn-8ciEWU-5vmcDa-o2NbGq-dxpJTW-cyGt4d-dZy9Sm-dZssjK-oVZ3SB-5BtrCp-e4z5Mk-6bvjNs-8cfk5H-dzTiW2-7Yfj3T-9mraHV-5XmJTS-aDtnzj-ruXg4M-ecF3x2-aAU6Fg-bsQosb-Hgh9UM-kJti5g-ifdCE4-ceXXhf-7AdkFZ-aEDYpr-otaizi-sa1Phn -->
<img src="images/your_turn.jpg" class="cover height" />

<p style="color: white">
Write a for loop that calculates and stores the career batting average for each player (note, batting average is number of hits, `h`, divided by number of at bats, `ab`, in a player's career.)
</p>
<p style="color: white">
<b>Hint:</b> You can get the unique player ids using the following:
</p>

```{r}
players <- unique(baseball$id)
```

## How did it go?

- Household chores (declaring variables, setting values each time) distract from real work
- Indices are error-prone
- Loops often result in slow code because R can compute quantities using entire vectors in an optimized way

## Enter: `dplyr`

`dplyr` is a Hadley package that implements the "split-apply-combine" strategy.

```{r, message=FALSE}
library(dplyr)
```

<img src="images/split-apply-combine.png" height="380px"/>

## Verbs


## Group by

## Summarise

## The pipe

The pipe operator in `dplyr` actually comes from a package called `magrittr`, and is meant to simplify your code into readable, sequential operators (almost like stringing together actions into a story).


```r
x %>% f()
```

The above code can be read as "Take `x`, **and then** do `f`". The `%>%` operator takes whatever is to the left of it and plugs it in as the first argument in the function to the right. So, this is equivalent to

```r
f(x)
```

## The Treachery of Images

This allows you to string together operations sequentially.

```{r, message=FALSE}
baseball %>%
  group_by(id) %>%
  summarise(ba = mean(h/ab)) %>% 
  tail(2)
```

![](images/magrittr.png) <img src="images/MagrittePipe.jpg" height="210px"/>