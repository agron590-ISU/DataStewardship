---
title: "The tidyverse continues"
author: "Ranae Dietzel & Andee Kaplan"
ratio: 16x10
output:
  rmdshower::shower_presentation:
    self_contained: false
    katex: true
    theme: ribbon
    incremental: true
---

#tidyr  

## Today's lecture brought to you by 

 <center><img src="images/r4ds_cover.jpg" width="300px" /></center>  
 [A book about data science in the tidyverse](http://r4ds.had.co.nz/)

## Tibbles  
  Like a dataframe, but does less 
  
  * Never changes the type of inputs  
  * Never changes the names of variables  
  * Never creates row names  
  * Is not as picky about column names (accepts spaces or names beginning with numbers)  
      - These must be surrounded by backticks  
      
## Tibbles  
  When you print a tibble, you see  
  
  * First 10 rows  
  * Type of column
  * Only the columns that fit on the screen (other columns listed)  
      - If you want to see all the columns use `width = Inf`.  
  
## Tidy data  

 <center><img src="images/tidy_1.png" width="800px" /></center>  
 
 * Each variable must have its own column.    
 * Each observation must have its own row.  
 * Each value must have its own cell.  

## Why tidy data  

* Consistent data structure allows easier learning of related tools because they have an underlying uniformity  
* Placing variables in columns takes advantage of R's vectorized nature  
* ggplot2 and dplyr are best friends with tidy data  

##  Very easy to find data that is well organized, but not tidy 

```{r, include=FALSE}
library(tidyverse)
```

```{r, echo=FALSE }
df<-data.frame(property=c("pH", "NO3", "clay", "silt", "sand"),
                    five_cm = c(7, 35, 20, 20, 60),
                    ten_cm = c(6.7, 22, 20, 20, 60),
                    fifteen_cm = c(6.5, 20, 20, 20, 60),
                    twenty_cm = c(6.4, 18, 20, 20, 60),
                   stringsAsFactors=FALSE)

soil<-as_tibble(df)
soil
```

Plot the change in pH across depth?

##  `gather`  
When column names are *values* instead of variables, we need to `gather` 
```{r, echo=FALSE}
soil
```

* We need to know the columns that are the values that need to be incorporated  
* The name of the variable for the values, here it is `depth`. This is the `key`.  


##  `gather`  
 
```{r, echo=FALSE}
soil
```

> * The name of the variable whose values are spread over the cells. This is the  `value`. If you know what it is, name it (NO3ppm). If you have many mixed units, you can use `value = value` or `value = measured` etc.

## `gather`  
```{r}
tidy_soil<-gather(soil, five_cm, ten_cm, fifteen_cm, twenty_cm, 
                  key=depth, value=value)
tidy_soil
```

##  
```{r}
filter(tidy_soil, property == "pH")%>%
ggplot(aes(x=depth, y=value))+
  geom_point(size=3)
```
Almost!  

##  `spread`

Use this if one of your columns is full of what could be headers
```{r, echo=FALSE, include=FALSE}
crops<-read_csv("data/NASS-Iowa.csv")
```

```{r, echo=FALSE}
oats<-(crops[crops$Commodity == "OATS", c(2, 16, 17, 20)])  
head(oats)
```

* Now column that includes the variable names is `key`, here it is `Data Item`.  
* Column that contains the values is the `value` column, here they already have it as `Values` 

##   
```{r}
spread(oats, key = `Data Item`, value = Value)
```

## 
```{r}
spread(oats, key = `Data Item`, value = Value)%>%
ggplot(aes(y=`OATS - YIELD, MEASURED IN BU / ACRE`,
           x = `OATS - ACRES HARVESTED`, label = Year))+
        geom_text()
```

## Your turn { .cover .white }

<!-- image source https://www.flickr.com/photos/ollemhebb/16691684354/in/photolist-rqZfeh-dB2HGy-j4rtWV-cswQCb-bnmKUX-rurYD7-5vmdw6-7iHPtj-bvggjZ-7nwAyK-oVZdhD-acwkds-dqAf8f-e4z5Jk-6PBenY-dSAYZ9-5vmcGR-e4z7be-cyGrpE-7WLPaw-5vmdnn-8ciEWU-5vmcDa-o2NbGq-dxpJTW-cyGt4d-dZy9Sm-dZssjK-oVZ3SB-5BtrCp-e4z5Mk-6bvjNs-8cfk5H-dzTiW2-7Yfj3T-9mraHV-5XmJTS-aDtnzj-ruXg4M-ecF3x2-aAU6Fg-bsQosb-Hgh9UM-kJti5g-ifdCE4-ceXXhf-7AdkFZ-aEDYpr-otaizi-sa1Phn -->
<img src="images/your_turn.jpg" class="cover height" />


<ol style="color:black">
<li>Use the NASS data to determine the relationship between time and change in bu/acre of corn </li>
<li>Examine the same relationship, but split into 1940-1990 and 1991-2015 and compare the slopes of the linear models </li>
<li>Compare "acres harvested" of small grains (oats, barley, wheat, and rye) to "acres harvested" of corn and soybean over the last 100 years.</li>
</ol>
    